


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > WorldView</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">inf112.starhunt.view</a>
</div>

<h1>Coverage Summary for Class: WorldView (inf112.starhunt.view)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">WorldView</td>
<td class="coverageStat">
  <span class="percent">
    69,2%
  </span>
  <span class="absValue">
    (18/26)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    45,2%
  </span>
  <span class="absValue">
    (19/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    65,8%
  </span>
  <span class="absValue">
    (104/158)
  </span>
</td>
</tr>
  <tr>
    <td class="name">WorldView$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    70,4%
  </span>
  <span class="absValue">
    (19/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    45,2%
  </span>
  <span class="absValue">
    (19/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    66%
  </span>
  <span class="absValue">
    (105/159)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package inf112.starhunt.view;
&nbsp;
&nbsp;import com.badlogic.gdx.Gdx;
&nbsp;import com.badlogic.gdx.Screen;
&nbsp;import com.badlogic.gdx.graphics.Color;
&nbsp;import com.badlogic.gdx.graphics.Texture;
&nbsp;import com.badlogic.gdx.graphics.g2d.BitmapFont;
&nbsp;import com.badlogic.gdx.graphics.g2d.GlyphLayout;
&nbsp;import com.badlogic.gdx.graphics.g2d.SpriteBatch;
&nbsp;import com.badlogic.gdx.graphics.g2d.TextureRegion;
&nbsp;import com.badlogic.gdx.math.MathUtils;
&nbsp;import com.badlogic.gdx.utils.ScreenUtils;
&nbsp;import com.badlogic.gdx.utils.viewport.ExtendViewport;
&nbsp;import com.badlogic.gdx.utils.viewport.Viewport;
&nbsp;import inf112.starhunt.model.GameState;
&nbsp;import inf112.starhunt.model.gameobject.Transform;
&nbsp;import inf112.starhunt.model.gameobject.ViewableObject;
&nbsp;import inf112.starhunt.model.gameobject.mobileobject.actor.Player;
&nbsp;import com.badlogic.gdx.graphics.g2d.freetype.FreeTypeFontGenerator;
&nbsp;
&nbsp;import java.util.EventListener;
&nbsp;import java.util.HashMap;
&nbsp;
&nbsp;public class WorldView extends AbstractScreen implements EventListener {
&nbsp;    private final ViewableWorldModel model;
&nbsp;    private SpriteBatch batch;
&nbsp;    private Texture headerTexture;
&nbsp;    private ParallaxBackground parallaxBackground;
&nbsp;    private BitmapFont font;
&nbsp;    private GlyphLayout layout;
&nbsp;    private HashMap&lt;String, Texture&gt; textures;
&nbsp;    private PlayerAnimation playerAnimation;
&nbsp;    private GameState gameState;
&nbsp;    private SoundHandler soundHandler;
&nbsp;    private final Viewport viewport;
&nbsp;
<b class="fc">&nbsp;    public WorldView(ViewableWorldModel model, int width, int height) {</b>
<b class="fc">&nbsp;        this.viewport = new ExtendViewport(width, height);</b>
<b class="fc">&nbsp;        this.model = model;</b>
<b class="fc">&nbsp;        this.layout = new GlyphLayout();</b>
<b class="fc">&nbsp;        this.textures = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;        this.gameState = model.getGameState();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * The following 6 setters are only for testing purposes
&nbsp;     */
<b class="fc">&nbsp;    void setFont(BitmapFont font) { this.font = font; }</b>
<b class="fc">&nbsp;    void setBatch(SpriteBatch batch) { this.batch = batch; }</b>
<b class="fc">&nbsp;    void setParallaxBackground(ParallaxBackground bg) { this.parallaxBackground = bg; }</b>
<b class="fc">&nbsp;    void setPlayerAnimation(PlayerAnimation animation) { this.playerAnimation = animation; }</b>
<b class="fc">&nbsp;    void setTextures(HashMap&lt;String, Texture&gt; textures) { this.textures = textures; }</b>
<b class="fc">&nbsp;    void setLayout(GlyphLayout layout) {this.layout = layout;}</b>
<b class="fc">&nbsp;    HashMap&lt;String, Texture&gt; getTextures(){return textures;}</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public void dispose() {
<b class="fc">&nbsp;        batch.dispose();</b>
<b class="fc">&nbsp;        font.dispose();</b>
<b class="fc">&nbsp;        parallaxBackground.dispose();</b>
<b class="fc">&nbsp;        playerAnimation.dispose();</b>
<b class="fc">&nbsp;        for (Texture texture : textures.values()){</b>
<b class="fc">&nbsp;            texture.dispose();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void show() {
<b class="nc">&nbsp;        parallaxBackground = new ParallaxBackground(model.getLevelWidth());</b>
<b class="nc">&nbsp;        playerAnimation = new PlayerAnimation();</b>
<b class="nc">&nbsp;        loadTextures();</b>
<b class="nc">&nbsp;        batch = new SpriteBatch();</b>
<b class="nc">&nbsp;        headerTexture = new Texture(&quot;background/header.png&quot;);</b>
<b class="nc">&nbsp;        soundHandler = new SoundHandler();</b>
<b class="nc">&nbsp;        font = loadFont(&quot;font/VT323-Regular.ttf&quot;);</b>
<b class="nc">&nbsp;        model.getViewablePlayer().setOnCoinCollected(() -&gt; soundHandler.playSound(&quot;coin&quot;));</b>
<b class="nc">&nbsp;        model.getViewablePlayer().setOnCollisionWithEnemy(() -&gt; soundHandler.playSound(&quot;ouch&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    private BitmapFont loadFont(String fontFilePath) {
<b class="nc">&nbsp;        FreeTypeFontGenerator generator = new FreeTypeFontGenerator(Gdx.files.internal(fontFilePath));</b>
<b class="nc">&nbsp;        FreeTypeFontGenerator.FreeTypeFontParameter parameter = new FreeTypeFontGenerator.FreeTypeFontParameter();</b>
<b class="nc">&nbsp;        parameter.size = 24;</b>
<b class="nc">&nbsp;        parameter.color = Color.WHITE;</b>
<b class="nc">&nbsp;        parameter.borderWidth = 1f;</b>
<b class="nc">&nbsp;        parameter.borderColor = Color.BLACK;</b>
<b class="nc">&nbsp;        BitmapFont font = generator.generateFont(parameter);</b>
<b class="nc">&nbsp;        generator.dispose();</b>
<b class="nc">&nbsp;        return font;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void render(float v) {
<b class="fc">&nbsp;        gameState = model.getGameState();</b>
<b class="pc">&nbsp;        switch (model.getGameState()) {</b>
<b class="fc">&nbsp;            case GAME_MENU -&gt; drawGameMenu();</b>
<b class="nc">&nbsp;            case GAME_ACTIVE -&gt; drawGameActive();</b>
<b class="nc">&nbsp;            case GAME_PAUSED -&gt; drawGamePaused();</b>
<b class="nc">&nbsp;            case GAME_OVER -&gt; drawGameOver();</b>
&nbsp;        }
&nbsp;
<b class="pc">&nbsp;        if (!model.getInfoMode() &amp;&amp; (gameState == GameState.GAME_MENU || gameState == GameState.GAME_PAUSED)) {</b>
<b class="fc">&nbsp;            drawCenteredText(&quot;Press &#39;i&#39; for game info&quot;,2, 300);</b>
<b class="nc">&nbsp;        } else if (model.getInfoMode() &amp;&amp; (gameState == GameState.GAME_MENU || gameState == GameState.GAME_PAUSED)) {</b>
<b class="nc">&nbsp;            drawGameInfo();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void drawGameMenu() {
<b class="fc">&nbsp;        ScreenUtils.clear(Color.CLEAR);</b>
<b class="fc">&nbsp;        float headerWidth = 800f;</b>
<b class="fc">&nbsp;        float headerHeight = 400f;</b>
<b class="fc">&nbsp;        float margin = 50f;</b>
<b class="fc">&nbsp;        float headerX = (Gdx.graphics.getWidth() - headerWidth) / 2f;</b>
<b class="fc">&nbsp;        float headerY = Gdx.graphics.getHeight() - headerHeight - margin;</b>
&nbsp;
<b class="fc">&nbsp;        batch.begin();</b>
<b class="fc">&nbsp;        parallaxBackground.render(batch);</b>
<b class="pc">&nbsp;        if (gameState.equals(GameState.GAME_MENU) &amp;&amp; !model.getInfoMode()) {</b>
<b class="fc">&nbsp;            batch.draw(headerTexture, headerX, headerY, headerWidth, headerHeight);</b>
&nbsp;        }
<b class="fc">&nbsp;        batch.end();</b>
&nbsp;
<b class="fc">&nbsp;        drawCenteredText(&quot;Press ENTER to start the game&quot;, 3,100);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void drawGameInfo() {
<b class="nc">&nbsp;        if (gameState.equals(GameState.GAME_MENU)) {</b>
<b class="nc">&nbsp;            font.setColor(Color.GOLD);</b>
<b class="nc">&nbsp;            drawCenteredText(&quot;Race to catch the star and grab as many coins as you can! Watch out for enemies â€” a single fall\n&quot; +</b>
&nbsp;                    &quot;or hit could cost you everything. Jump on enemies to knock them out, and munch on bananas to grow\n&quot; +
&nbsp;                    &quot;bigger and tougher! Time&#39;s ticking... complete your mission before it&#39;s too late!&quot;, 1.3f, 200);
<b class="nc">&nbsp;            drawCenteredText(&quot;Ready? GO!&quot;, 1.5f, 350);</b>
<b class="nc">&nbsp;            font.setColor(Color.WHITE);</b>
&nbsp;        }
<b class="nc">&nbsp;        drawCenteredText(&quot;Press &#39;i&#39; to remove game info&quot;, 3,-400);</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;To jump press &#39;w&#39;, &#39;space&#39; or up-arrow\n&quot; +</b>
&nbsp;                &quot;To move right press &#39;d&#39; or right arrow\n&quot; +
&nbsp;                &quot;To move left press &#39;a&#39; or left arrow\n&quot; +
&nbsp;                &quot;To pause the game when playing press &#39;p&#39;\n&quot; +
&nbsp;                &quot;To exit the game at any time press ESC&quot;, 2,-350);
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void drawGameActive() {
<b class="nc">&nbsp;        drawLevel();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void drawGamePaused() {
<b class="nc">&nbsp;        drawLevel();</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;PAUSED&quot;, 3, 0);</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;Press &#39;r&#39; to return to the game menu&quot;, 3, 330);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void drawGameOver() {
<b class="nc">&nbsp;        ScreenUtils.clear(Color.CLEAR);</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;GAME OVER&quot;, 4.5f, 0);</b>
<b class="nc">&nbsp;        font.getData().setScale(1);</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;Press ENTER to return to the game menu&quot;, 2, -200);</b>
<b class="nc">&nbsp;        drawCenteredText(&quot;Score: &quot; + model.getTotalScore() + &quot;   Level: &quot; + model.getLevelCounter(), 2, 200);</b>
&nbsp;    }
&nbsp;
&nbsp;    void drawCenteredText(String text, float textScale, float lowerTextBy) {
<b class="fc">&nbsp;        font.getData().setScale(textScale);</b>
<b class="fc">&nbsp;        layout.setText(font, text);</b>
&nbsp;
<b class="fc">&nbsp;        float centerX = viewport.getCamera().position.x;</b>
<b class="fc">&nbsp;        float centerY = viewport.getCamera().position.y;</b>
<b class="fc">&nbsp;        float width = layout.width;</b>
<b class="fc">&nbsp;        float height = layout.height;</b>
&nbsp;
<b class="fc">&nbsp;        batch.begin();</b>
<b class="fc">&nbsp;        font.draw(batch, text, centerX- width/2, centerY - height/2 - lowerTextBy);</b>
<b class="fc">&nbsp;        batch.end();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void drawPlayer(float deltaTime, int movementDirection, GameState gameState){
&nbsp;        // Player-data
<b class="fc">&nbsp;        Transform playerTransform = model.getViewablePlayer().getTransform();</b>
<b class="fc">&nbsp;        float playerX = playerTransform.getPos().x;</b>
<b class="fc">&nbsp;        float playerY = playerTransform.getPos().y;</b>
<b class="fc">&nbsp;        float playerWidth = playerTransform.getSize().x;</b>
<b class="fc">&nbsp;        float playerHeight = playerTransform.getSize().y;</b>
&nbsp;
<b class="fc">&nbsp;        TextureRegion currentFrame = playerAnimation.getFrame(movementDirection);</b>
<b class="fc">&nbsp;        boolean isPaused = !gameState.equals(GameState.GAME_ACTIVE);</b>
<b class="fc">&nbsp;        playerAnimation.update(deltaTime,  isPaused);</b>
<b class="fc">&nbsp;        batch.draw(currentFrame, playerX, playerY, playerWidth, playerHeight);</b>
&nbsp;    }
&nbsp;
&nbsp;    void drawLevel() {
&nbsp;
&nbsp;        // Map-data
<b class="fc">&nbsp;        float deltaTime = Gdx.graphics.getDeltaTime();</b>
&nbsp;
&nbsp;        // Camera
<b class="fc">&nbsp;        ScreenUtils.clear(Color.CLEAR);</b>
<b class="fc">&nbsp;        updateViewportCamera();</b>
<b class="fc">&nbsp;        batch.setProjectionMatrix(viewport.getCamera().combined);</b>
&nbsp;
&nbsp;        // Text to be shown
<b class="fc">&nbsp;        String totalScore = &quot;Total score: &quot;+ model.getTotalScore();</b>
<b class="fc">&nbsp;        String coinCount = &quot;Coins: &quot; + model.getCoinCounter();</b>
<b class="fc">&nbsp;        String lives = &quot;Lives: &quot; + model.getPlayerLives();</b>
<b class="fc">&nbsp;        String countDown = &quot;CountDown: &quot; + model.getCountDown();</b>
<b class="fc">&nbsp;        String levelCount = &quot;Level: &quot; + model.getLevelCounter();</b>
<b class="fc">&nbsp;        font.getData().setScale(2);</b>
&nbsp;
<b class="fc">&nbsp;        float screenHeight = viewport.getWorldHeight();</b>
<b class="fc">&nbsp;        float leftX = getViewportLeftX();</b>
&nbsp;
&nbsp;        // Parallax background
<b class="fc">&nbsp;        int movementDirection = model.getMovementDirection();</b>
<b class="pc">&nbsp;        parallaxBackground.update(movementDirection, deltaTime, model.getGameState() != GameState.GAME_ACTIVE);</b>
&nbsp;
&nbsp;        // Drawing objects
<b class="fc">&nbsp;        batch.begin();</b>
<b class="fc">&nbsp;        parallaxBackground.render(batch);</b>
<b class="fc">&nbsp;        font.draw(batch, lives, leftX + 80, screenHeight - 15);</b>
<b class="fc">&nbsp;        font.draw(batch, coinCount, leftX + 320, screenHeight - 15);</b>
<b class="fc">&nbsp;        font.draw(batch, totalScore, leftX + 550, screenHeight - 15);</b>
<b class="fc">&nbsp;        font.draw(batch, countDown, leftX + 930, screenHeight - 15);</b>
<b class="fc">&nbsp;        font.draw(batch, levelCount, leftX + 1300, screenHeight - 15);</b>
<b class="fc">&nbsp;        drawPlayer(deltaTime, movementDirection, gameState);</b>
<b class="fc">&nbsp;        drawObjects();</b>
<b class="fc">&nbsp;        batch.end();</b>
&nbsp;    }
&nbsp;
&nbsp;    void updateViewportCamera() {
<b class="nc">&nbsp;        Transform playerTransform = model.getViewablePlayer().getTransform();</b>
<b class="nc">&nbsp;        float playerX = playerTransform.getPos().x;</b>
<b class="nc">&nbsp;        float playerWidth = playerTransform.getSize().x;</b>
<b class="nc">&nbsp;        float playerCenterX = playerX + playerWidth / 2;</b>
<b class="nc">&nbsp;        float camX = viewport.getCamera().position.x;</b>
<b class="nc">&nbsp;        float camY = viewport.getCamera().position.y;</b>
<b class="nc">&nbsp;        float screenWidth = viewport.getWorldWidth();</b>
&nbsp;
<b class="nc">&nbsp;        if (playerCenterX &gt; camX &amp;&amp; camX &lt; model.getBoardWidth() - screenWidth / 2) {</b>
<b class="nc">&nbsp;            camX = playerCenterX;</b>
&nbsp;        }
<b class="nc">&nbsp;        camX = MathUtils.clamp(camX, screenWidth/2, 5000 - screenWidth/2); // bytt 5000 med bredden av brettet</b>
&nbsp;
<b class="nc">&nbsp;        viewport.getCamera().position.set(camX, camY, 0);</b>
<b class="nc">&nbsp;        viewport.apply();</b>
<b class="nc">&nbsp;        model.updateViewportLeftX(getViewportLeftX());</b>
&nbsp;    }
&nbsp;
&nbsp;    void loadTextures(){
<b class="fc">&nbsp;        textures.put(&quot;leopard&quot;, new Texture(&quot;assets/leopard.png&quot;));</b>
<b class="fc">&nbsp;        textures.put(&quot;snail&quot;, new Texture(&quot;assets/snail.png&quot;));</b>
<b class="fc">&nbsp;        textures.put(&quot;coin&quot;, new Texture(&quot;assets/coin.png&quot;));</b>
<b class="fc">&nbsp;        textures.put(&quot;powerup&quot;, new Texture(&quot;assets/banana.png&quot;));</b>
<b class="fc">&nbsp;        textures.put(&quot;ground&quot;, new Texture(&quot;obstacles/castleCenter.png&quot;));</b>
<b class="fc">&nbsp;        textures.put(&quot;star&quot;, new Texture(&quot;assets/star.png&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    Texture getTexture(ViewableObject obj){
<b class="fc">&nbsp;        String className = obj.getClass().getSimpleName();</b>
<b class="fc">&nbsp;        return switch (className) {</b>
<b class="fc">&nbsp;            case &quot;Leopard&quot; -&gt; textures.get(&quot;leopard&quot;);</b>
<b class="fc">&nbsp;            case &quot;Snail&quot; -&gt; textures.get(&quot;snail&quot;);</b>
<b class="fc">&nbsp;            case &quot;Coin&quot; -&gt; textures.get(&quot;coin&quot;);</b>
<b class="fc">&nbsp;            case &quot;Banana&quot; -&gt; textures.get(&quot;powerup&quot;);</b>
<b class="fc">&nbsp;            case &quot;Ground&quot; -&gt; textures.get(&quot;ground&quot;);</b>
<b class="fc">&nbsp;            case &quot;Star&quot; -&gt; textures.get(&quot;star&quot;);</b>
<b class="fc">&nbsp;            default -&gt; throw new IllegalArgumentException(&quot;Unsupported class name for texture: &quot; + className);</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    void drawObjects() {
<b class="fc">&nbsp;        for (ViewableObject object : model.getObjectList()) {</b>
&nbsp;
<b class="fc">&nbsp;            if (object instanceof Player) continue;</b>
<b class="fc">&nbsp;            int direction = object.getDirection();</b>
&nbsp;
<b class="fc">&nbsp;            Texture objectTexture = getTexture(object);</b>
&nbsp;
<b class="fc">&nbsp;            float objectX = object.getTransform().getPos().x;</b>
<b class="fc">&nbsp;            float objectY = object.getTransform().getPos().y;</b>
<b class="fc">&nbsp;            float objectWidth = object.getTransform().getSize().x;</b>
<b class="fc">&nbsp;            float objectHeight = object.getTransform().getSize().y;</b>
&nbsp;
<b class="pc">&nbsp;            if (direction &gt;= 0) {</b>
<b class="fc">&nbsp;                batch.draw(objectTexture, objectX + objectWidth, objectY, -objectWidth, objectHeight);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                batch.draw(objectTexture, objectX, objectY, objectWidth, objectHeight);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private float getViewportLeftX() {
<b class="fc">&nbsp;        return viewport.getCamera().position.x - viewport.getWorldWidth() / 2;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void resize(int width, int height) {
<b class="nc">&nbsp;        viewport.update(width, height, true);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-04-30 10:42</div>
</div>
</body>
</html>
